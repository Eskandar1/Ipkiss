<!DOCTYPE html>
<html>
  <head>
      <title>Ipkiss</title>
      <link rel="icon" href="../static/mask_icon_140145.ico">
      <link rel="stylesheet" href="../static/materialize/css/materialize.min.css"/>
      <script src="../static/materialize/js/materialize.min.js"></script>
      <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
      <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
      <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <style>
          .ct-perfect-fourth:before{
              padding-bottom: 25%;
          }
      </style>
  </head>
  <body>
    <nav class="nav-wrapper light-green">
        <a href="#" class="brand-logo">Ipkiss</a>
    </nav>
    <div class="container">
        <div>
            <h3 class="center-align">Ipkiss</h3>
        </div>
        <br/>
        <div>
            <img class="responsive-img" src="{{ url_for('video_raiz') }}" alt="Imagens capturadas pela câmera">
        </div>
        <br/>
        <div class="row">
            <div class="col s12 m7">
                Ordenar por:
            </div>
            <button id="horas" class="btn-small disabled" onclick="botoes(0, this)">Horas</button>
            <button id="dias" class="waves-effect waves-light btn-small light-green lighten-1" onclick="botoes(1, this)">Dias</button>
            <button id="meses" class="waves-effect waves-light btn-small light-green lighten-1" onclick="botoes(2, this)">Meses</button>
        </div>
        <div class="ct-chart ct-perfect-fourth"></div>
    </div>
  </body>
  <footer class="page-footer red">
      <div class="footer-copyright">
          <div class="container center">
              ©Todos os Direitos Autorais são de propriedade da instituição de ensino IFSP - 2020
          </div>
    </div>
  </footer>
  <script>
    var getData = $.get('/horas');
    var MyChart;
    getData.done(function (results) {
        var data = {
            labels : troca_graf(results.type),
            series : [results.results]
            };
        var options = {
            width: '800px',
            height: '200px'
        };

        MyChart = new Chartist.Line('.ct-chart', data, options);
    });
    function updateChart() {
        var updateData = $.get('/data');
        updateData.done(function (results) {
            var data = {
            labels : ['Seg', 'Ter', 'Qua', 'Qui', 'Sex'],
            series : [results.results]
            };
            MyChart.update(data);
        });
    }
    function botoes(tipo, botao){
        desativado = $('.disabled');
        desativado.removeClass().addClass('waves-effect waves-light btn-small light-green lighten-1');
        bt = $(botao);
        bt.removeClass().addClass('btn-small disabled');
        var dado;
        if(tipo == 0){
            dado = $.get('/horas');
        }else if(tipo == 1){
            dado = $.get('/dias');
        }else if(tipo == 2){
            dado = $.get('/meses');
        }
        dado.done(function (results) {
            var data = {
            labels : troca_graf(tipo),
            series : [results.results]
            };
            MyChart.update(data);
        })
    }
    $('#update').on('click', updateChart);

    function diasNoMes() {
        var hj = new Date();
        var data = new Date(hj.getFullYear(), hj.getMonth()+1, 0);
        return data.getDate();
    }
    function troca_graf(tipo){
        var eixo_x = [];
        if(tipo == 0){
            eixo_x = ['00:00','01:00','02:00','03:00','04:00','05:00','06:00','07:00','08:00','09:00','10:00','11:00',
                '12:00', '13:00','14:00','15:00','16:00','17:00','18:00','19:00','20:00','21:00','22:00','23:00']
        }
        else if(tipo == 1){
            lastday = diasNoMes();
            for(x=1; x<=lastday; x++){
                if(x<10){
                    eixo_x.push('0'+x.toString())
                }else{
                    eixo_x.push(x.toString())
                }
            }
        }
        else if(tipo == 2){
            eixo_x = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez']
        }
        return eixo_x;
    }
  </script>
</html>